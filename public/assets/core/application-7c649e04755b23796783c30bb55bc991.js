!function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var n=t.currentTarget,r=e(n).data("association"),i=e("#"+e(n).data("blueprint-id")),a=i.data("blueprint"),o=(e(n).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(o)for(var d=o.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],s=o.match(/[0-9]+/g)||[],l=0;l<d.length;l++)s[l]&&(a=a.replace(new RegExp("(_"+d[l]+")_.+?_","g"),"$1_"+s[l]+"_"),a=a.replace(new RegExp("(\\["+d[l]+"\\])\\[.+?\\]","g"),"$1["+s[l]+"]"));var c=new RegExp("new_"+r,"g"),u=this.newId();a=e.trim(a.replace(c,u));var f=this.insertFields(a,r,n);return f.trigger({type:"nested:fieldAdded",field:f}).trigger({type:"nested:fieldAdded:"+r,field:f}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,n,r){var i=e(r).data("target");return i?e(t).appendTo(e(i)):e(t).insertBefore(r)},removeFields:function(t){var n=e(t.currentTarget),r=n.data("association"),i=n.prev("input[type=hidden]");i.val("1");var a=n.closest(".fields");return a.hide(),a.trigger({type:"nested:fieldRemoved",field:a}).trigger({type:"nested:fieldRemoved:"+r,field:a}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(jQuery),function(e){e.fn.closestChild=function(t){if(t&&""!=t){var n=[];for(n.push(this);n.length>0;)for(var r=n.shift(),i=r.children(),a=0;a<i.length;++a){var o=e(i[a]);if(o.is(t))return o;n.push(o)}}return e()}}(jQuery),function(){$(function(){return $("#new_department_adder").on("click",function(){return $("#employment_organization_department_name").attr("type","text"),$("#new_department_adder").hide(),!1})})}.call(this),function(){$(function(){var e;return $("#new_city_adder").on("click",function(){return $("#organization_city_title").attr("type","text"),$("#new_city_adder").hide(),!1}),$("#q_country_id_eq").change(function(){var t,n,r;return t=$(this).val(),r="/core/countries/"+t+"/cities",n=$("#q_city_id_eq"),n.select2("val",""),n.data("source",r),e(n)}),$("#organization_country_id").change(function(){var t,n,r;return t=$(this).val(),r="/core/countries/"+t+"/cities",n=$("#organization_city_id"),n.select2("val",""),n.data("source",r),e(n)}),e=function(e){var t,n;return n=$(e),t=n.find("option"),1===t.size()&&$(t[0]).select(),t={placeholder:select2_localization[window.locale],allowClear:!0},t.ajax={url:n.data("source"),dataType:"json",quietMillis:100,data:function(e,t){return{q:$.trim(e),page:t,per:10}},results:function(e,t){var n;return n=void 0,n=10*t<e.total,{results:e.records,more:n}}},t.dropdownCssClass="bigdrop",t.initSelection=function(e,t){return e.val().length>0?$.getJSON(n.data("source")+"/"+e.val(),{},function(e){return t({id:e.id,text:e.text})}):void 0},n.select2(t)}})}.call(this),$().ready(function(){$("#member_adder").bind("click",function(){return $("tr#new_member_row").toggleClass("hidden"),!1}),$(".project_access_toggle").each(function(){return $(this).on("click",function(){return $.ajax({url:$(this).attr("url"),type:"PUT"})})})}),function(){$(function(){var e;return $("#project_organization_id").change(function(){var t,n,r;return t=$(this).val(),r="/core/organizations/"+t+"/departments",n=$("#project_organization_department_id"),n.select2("val",""),n.data("source",r),e(n)}),e=function(e){var t,n;return n=$(e),t=n.find("option"),1===t.size()&&$(t[0]).select(),t={placeholder:select2_localization[window.locale],allowClear:!0},t.ajax={url:n.data("source"),dataType:"json",quietMillis:100,data:function(e,t){return{q:$.trim(e),page:t,per:10}},results:function(e,t){var n;return n=void 0,n=10*t<e.total,{results:e.records,more:n}}},t.dropdownCssClass="bigdrop",t.initSelection=function(e,t){return e.val().length>0?$.getJSON(n.data("source")+"/"+e.val(),{},function(e){return t({id:e.id,text:e.text})}):void 0},n.select2(t)}})}.call(this);